<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="post">
	
	<insert id="insertPost" parameterType="PostVo">
		<![CDATA[
			INSERT INTO post
			VALUES (seq_post_no.nextval, #{cateNo}, #{postTitle}, #{postContent}, SYSDATE)
		]]>
	</insert>
	
	
	<select id="selectRecent" parameterType="int" resultType="postVo">
		<![CDATA[
			SELECT ROWNUM rn
			       ,p.post_no postNo
			       ,p.post_title postTitle
			       ,c.id id
			       ,c.name userName
			       ,p.post_content postContent
			       ,TO_CHAR(p.reg_date, 'YYYY/MM/DD') regDate
			FROM   post p, (SELECT ROWNUM
			                       ,c.cate_no cateNo
			                       ,c.id id
			                       ,u.user_name name
			                FROM   users u, category c
			                WHERE  u.id = c.id
			                AND    c.cate_no = #{cateNo}
			                ORDER BY c.cate_no DESC
			                ) c
			WHERE  p.cate_no = c.cateNo
			AND    ROWNUM = 1 
		]]>
	</select>
	
	
	<select id="selectCatePost" parameterType="int" resultType="postVo">
		<![CDATA[
			SELECT c.cate_name cateName
			       ,p.post_no postNo
			       ,p.post_title postTitle
			       ,TO_CHAR(p.reg_date, 'YYYY/MM/DD') regDate
			FROM   category c, post p
			WHERE  c.cate_no = p.cate_no
			AND    c.cate_no = #{cateNo}
			ORDER BY c.cate_no DESC
		]]>
	</select>
</mapper>